<view wx:if="{{loading}}" class="loading-wrapper">
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>

<view wx:else>
  <!-- èµ„æºåŸºç¡€ä¿¡æ¯ -->
  <view class="card resource-card">
    <view class="section-header">
      <view class="section-title-wrapper">
        <view class="section-icon">ğŸ“</view>
        <view class="text-title">åŸºç¡€ä¿¡æ¯</view>
      </view>
      <button size="mini" class="{{editBase ? 'btn-danger' : 'btn-secondary'}}" bindtap="toggleEditBase">
        {{editBase ? 'å–æ¶ˆ' : 'ç¼–è¾‘'}}
      </button>
    </view>

    <view wx:if="{{!editBase}}" class="info-display">
      <view class="info-item-enhanced">
        <view class="info-label-wrapper">
          <text class="info-icon">ğŸ·ï¸</text>
          <text class="muted">èµ„æºåç§°</text>
        </view>
        <text class="text-subtitle info-value">{{resource.name || '-'}}</text>
      </view>
      
      <view class="divider" wx:if="{{resource.name}}"></view>
      
      <view class="info-item-enhanced" wx:if="{{resource.coverImg}}">
        <view class="info-label-wrapper">
          <text class="info-icon">ğŸ–¼ï¸</text>
          <text class="muted">å°é¢å›¾</text>
        </view>
        <view class="cover-image-wrapper">
          <image src="{{resource.coverImg}}" mode="aspectFill" class="cover-image" binderror="onImageError" lazy-load />
        </view>
      </view>
      
      <view class="divider" wx:if="{{resource.coverImg && (resource.latitude || resource.longitude)}}"></view>
      
      <view class="info-item-enhanced" wx:if="{{resource.latitude || resource.longitude}}">
        <view class="info-label-wrapper">
          <text class="info-icon">ğŸ“</text>
          <text class="muted">ä½ç½®åæ ‡</text>
        </view>
        <text class="text-subtitle info-value">{{resource.latitude}}, {{resource.longitude}}</text>
      </view>
      
      <view class="divider" wx:if="{{resource.hotScore !== undefined}}"></view>
      
      <view class="info-item-enhanced" wx:if="{{resource.hotScore !== undefined}}">
        <view class="info-label-wrapper">
          <text class="info-icon">ğŸ”¥</text>
          <text class="muted">çƒ­åº¦è¯„åˆ†</text>
        </view>
        <view class="hot-score-badge">
          <text class="hot-score-value">{{resource.hotScore}}</text>
        </view>
      </view>
    </view>

    <view wx:else class="edit-form">
      <view class="input-group-enhanced">
        <view class="input-label-wrapper">
          <text class="input-icon">ğŸ·ï¸</text>
          <view class="text-label">èµ„æºåç§° <text class="required-mark">*</text></view>
        </view>
        <input placeholder="è¯·è¾“å…¥èµ„æºåç§°" value="{{baseForm.name}}" bindinput="onNameInput" maxlength="64" class="enhanced-input" />
      </view>

      <view class="input-group-enhanced" style="margin-top: 32rpx;">
        <view class="input-label-wrapper">
          <text class="input-icon">ğŸ–¼ï¸</text>
          <view class="text-label">å°é¢å›¾ URL</view>
        </view>
        <input placeholder="è¯·è¾“å…¥å°é¢å›¾é“¾æ¥" value="{{baseForm.coverImg}}" bindinput="onCoverImgInput" class="enhanced-input" />
        <view class="input-hint">æ”¯æŒ http:// æˆ– https:// å¼€å¤´çš„å›¾ç‰‡é“¾æ¥</view>
      </view>

      <view class="row" style="margin-top: 32rpx; gap: 16rpx;">
        <view class="input-group-enhanced" style="flex: 1;">
          <view class="input-label-wrapper">
            <text class="input-icon">ğŸ“</text>
            <view class="text-label">çº¬åº¦</view>
          </view>
          <input type="digit" placeholder="ä¾‹å¦‚ï¼š23.123456" value="{{baseForm.latitude}}" bindinput="onLatitudeInput" class="enhanced-input" />
        </view>
        <view class="input-group-enhanced" style="flex: 1;">
          <view class="input-label-wrapper">
            <text class="input-icon">ğŸ“</text>
            <view class="text-label">ç»åº¦</view>
          </view>
          <input type="digit" placeholder="ä¾‹å¦‚ï¼š114.123456" value="{{baseForm.longitude}}" bindinput="onLongitudeInput" class="enhanced-input" />
        </view>
      </view>

      <button class="btn-primary save-btn" loading="{{saving}}" disabled="{{saving}}" bindtap="onSaveBase">
        {{saving ? 'ä¿å­˜ä¸­...' : 'ğŸ’¾ ä¿å­˜åŸºç¡€ä¿¡æ¯'}}
      </button>
    </view>
  </view>

  <!-- èµ„æºå†…å®¹ -->
  <view class="card content-card">
    <view class="section-header">
      <view class="section-title-wrapper">
        <view class="section-icon">ğŸ“„</view>
        <view class="text-title">å†…å®¹ç®¡ç†</view>
      </view>
      <button size="mini" class="{{editContent ? 'btn-danger' : 'btn-secondary'}}" bindtap="toggleEditContent">
        {{editContent ? 'å–æ¶ˆ' : 'ç¼–è¾‘'}}
      </button>
    </view>

    <view wx:if="{{!editContent}}" class="content-display">
      <block wx:for="{{resource.content}}" wx:key="index">
        <view class="content-block-enhanced">
          <view class="content-type-badge">
            <text wx:if="{{item.type === 'text'}}" class="type-icon">ğŸ“</text>
            <text wx:elif="{{item.type === 'image'}}" class="type-icon">ğŸ–¼ï¸</text>
            <text wx:elif="{{item.type === 'video'}}" class="type-icon">ğŸ¬</text>
            <text class="type-label">{{item.type === 'text' ? 'æ–‡æœ¬' : (item.type === 'image' ? 'å›¾ç‰‡' : 'è§†é¢‘')}}</text>
          </view>
          <view wx:if="{{item.type === 'text'}}" class="content-text-enhanced">
            <text>{{item.value}}</text>
          </view>
          <view wx:elif="{{item.type === 'image'}}" class="content-image-enhanced">
            <image src="{{item.value}}" mode="aspectFill" class="content-image" binderror="onImageError" lazy-load />
          </view>
          <view wx:elif="{{item.type === 'video'}}" class="content-video-enhanced">
            <video src="{{item.value}}" controls class="content-video"></video>
          </view>
        </view>
      </block>
      <view wx:if="{{!resource.content || resource.content.length === 0}}" class="empty-state-enhanced">
        <view class="empty-state-icon">ğŸ“„</view>
        <text class="empty-state-text">æš‚æ— å†…å®¹</text>
        <text class="empty-state-hint">ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®æ·»åŠ å†…å®¹</text>
      </view>
    </view>

    <view wx:else class="edit-content">
      <block wx:for="{{contentBlocks}}" wx:key="index">
        <view class="content-edit-block-enhanced">
          <view class="content-edit-header">
            <view class="content-type-badge-edit">
              <text wx:if="{{item.type === 'text'}}" class="type-icon-small">ğŸ“</text>
              <text wx:elif="{{item.type === 'image'}}" class="type-icon-small">ğŸ–¼ï¸</text>
              <text wx:elif="{{item.type === 'video'}}" class="type-icon-small">ğŸ¬</text>
              <view class="badge badge-info">{{item.type === 'text' ? 'æ–‡æœ¬' : (item.type === 'image' ? 'å›¾ç‰‡' : 'è§†é¢‘')}}</view>
            </view>
            <button size="mini" class="btn-danger btn-delete" bindtap="removeContentBlock" data-index="{{index}}">ğŸ—‘ï¸ åˆ é™¤</button>
          </view>
          <input 
            wx:if="{{item.type === 'text'}}"
            placeholder="è¯·è¾“å…¥æ–‡æœ¬å†…å®¹ï¼ˆæœ€å¤š500å­—ï¼‰" 
            value="{{item.value}}" 
            bindinput="onContentValueInput"
            data-index="{{index}}"
            maxlength="500"
            class="enhanced-input content-input"
          />
          <input 
            wx:elif="{{item.type === 'image' || item.type === 'video'}}"
            placeholder="è¯·è¾“å…¥èµ„æº URLï¼ˆhttp:// æˆ– https:// å¼€å¤´ï¼‰" 
            value="{{item.value}}" 
            bindinput="onContentValueInput"
            data-index="{{index}}"
            class="enhanced-input content-input"
          />
        </view>
      </block>

      <view class="add-content-buttons">
        <button size="mini" class="btn-add-content" bindtap="addTextBlock">
          <text class="btn-add-icon">ğŸ“</text>
          <text>æ·»åŠ æ–‡æœ¬</text>
        </button>
        <button size="mini" class="btn-add-content" bindtap="addImageBlock">
          <text class="btn-add-icon">ğŸ–¼ï¸</text>
          <text>æ·»åŠ å›¾ç‰‡</text>
        </button>
        <button size="mini" class="btn-add-content" bindtap="addVideoBlock">
          <text class="btn-add-icon">ğŸ¬</text>
          <text>æ·»åŠ è§†é¢‘</text>
        </button>
      </view>

      <button class="btn-primary save-btn" loading="{{saving}}" disabled="{{saving}}" bindtap="onSaveContent">
        {{saving ? 'ä¿å­˜ä¸­...' : 'ğŸ’¾ ä¿å­˜å†…å®¹'}}
      </button>
    </view>
  </view>
</view>

