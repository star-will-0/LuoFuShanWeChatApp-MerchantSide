<view class="card redeem-card">
  <view class="section-header">
    <view class="text-title">ğŸ« æ ¸é”€å…‘æ¢ç </view>
  </view>
  
  <view class="input-group" style="margin-top: 24rpx;">
    <view class="text-label">å…‘æ¢å¡å¯†</view>
    <input 
      placeholder="è¾“å…¥å…‘æ¢å¡å¯†ï¼Œä¾‹å¦‚ D92F-A2CD-89FE" 
      value="{{redeemCode}}" 
      bindinput="onRedeemCodeInput"
      maxlength="64"
    />
  </view>

  <button 
    class="btn-primary" 
    style="margin-top: 32rpx; width: 100%;" 
    loading="{{redeemLoading}}" 
    disabled="{{redeemLoading}}" 
    bindtap="onRedeem"
  >
    {{redeemLoading ? 'æ ¸é”€ä¸­...' : 'ç«‹å³æ ¸é”€'}}
  </button>

  <view wx:if="{{redeemResult}}" class="result-card">
    <view class="row" style="margin-bottom: 20rpx;">
      <view class="text-subtitle">âœ… æ ¸é”€æˆåŠŸ</view>
      <view class="badge badge-success">å·²å®Œæˆ</view>
    </view>
    <view class="divider"></view>
    <view class="result-item">
      <text class="muted">è®¢å•IDï¼š</text>
      <text class="text-subtitle">{{redeemResult.exchangeId}}</text>
    </view>
    <view class="result-item" style="margin-top: 16rpx;">
      <text class="muted">ç¤¼å“åç§°ï¼š</text>
      <text class="text-subtitle">{{redeemResult.itemName}}</text>
    </view>
    <view class="result-item" style="margin-top: 16rpx;">
      <text class="muted">æ ¸é”€é—¨åº—ï¼š</text>
      <text class="text-subtitle">{{redeemResult.placeName}}</text>
    </view>
    <view class="result-item" style="margin-top: 16rpx;">
      <text class="muted">æ ¸é”€æ—¶é—´ï¼š</text>
      <text class="text-subtitle">{{redeemResult.redeemedAt}}</text>
    </view>
  </view>
</view>

<view class="card filter-card">
  <view class="section-header">
    <view class="text-subtitle">ğŸ“‹ å…‘æ¢è®°å½•</view>
    <view class="row gap-small">
      <button 
        size="mini" 
        class="{{status==='unredeemed' ? 'btn-primary' : 'btn-secondary'}}" 
        bindtap="setUnredeemed"
      >
        æœªæ ¸é”€
      </button>
      <button 
        size="mini" 
        class="{{status==='redeemed' ? 'btn-primary' : 'btn-secondary'}}" 
        bindtap="setRedeemed"
      >
        å·²æ ¸é”€
      </button>
    </view>
  </view>
  <view class="muted" style="margin-top: 16rpx; font-size: 24rpx;">ç¬¬ {{page}} é¡µ</view>
</view>

<block wx:for="{{records}}" wx:key="recordId">
  <view class="card record-card">
    <view class="row">
      <view class="flex-column" style="flex: 1;">
        <view class="text-subtitle">{{item.itemName || ('ç¤¼å“#' + item.itemId)}}</view>
        <view class="muted" style="margin-top: 12rpx; font-size: 24rpx;">
          ğŸ”‘ å¡å¯†ï¼š{{item.code}}
        </view>
        <view class="row" style="margin-top: 12rpx; gap: 16rpx;">
          <view class="muted" wx:if="{{item.placeName}}" style="font-size: 24rpx;">
            ğŸª {{item.placeName}}
          </view>
          <view class="muted" wx:if="{{item.redeemedAt}}" style="font-size: 24rpx;">
            â° {{item.redeemedAt}}
          </view>
        </view>
      </view>
      <view>
        <view class="badge {{item.isRedeemed ? 'badge-success' : 'badge-warning'}}">
          {{item.isRedeemed ? 'å·²æ ¸é”€' : 'æœªæ ¸é”€'}}
        </view>
      </view>
    </view>
  </view>
</block>

<view class="card" wx:if="{{records.length === 0 && !listLoading}}">
  <view class="empty-state">
    <view class="empty-state-icon">ğŸ“</view>
    <text>æš‚æ— {{status === 'redeemed' ? 'å·²æ ¸é”€' : 'æœªæ ¸é”€'}}è®°å½•</text>
  </view>
</view>

<view class="card" wx:if="{{records.length > 0}}">
  <button 
    class="btn-primary" 
    style="width: 100%;" 
    loading="{{listLoading}}" 
    disabled="{{listLoading || !hasMore}}" 
    bindtap="loadMore"
  >
    {{listLoading ? 'åŠ è½½ä¸­...' : (hasMore ? 'åŠ è½½æ›´å¤š' : 'æ²¡æœ‰æ›´å¤šäº†')}}
  </button>
</view>


